@page "/predict"
@inject HttpClient Http

<h3>Blood Diagnosis Prediction</h3>

<div class="card p-3">

    <EditForm Model="@cbc" OnValidSubmit="@SendPrediction">
        <DataAnnotationsValidator />

        <!-- Dynamische Felder (hier einige Beispiele) -->
        <div class="mb-2">
            <label>RBC</label>
            <InputNumber @bind-Value="cbc.RBC" class="form-control" />
        </div>

        <div class="mb-2">
            <label>HGB</label>
            <InputNumber @bind-Value="cbc.HGB" class="form-control" />
        </div>

        <div class="mb-2">
            <label>WBC</label>
            <InputNumber @bind-Value="cbc.WBC" class="form-control" />
        </div>

        <div class="mb-2">
            <label>Platelets</label>
            <InputNumber @bind-Value="cbc.Platelets" class="form-control" />
        </div>

        <!-- Alle anderen Felder hier ergänzen, entsprechend deiner CSV -->

        <button class="btn btn-primary">Predict</button>
    </EditForm>

    @if (diagnosis != null)
    {
        <div class="alert alert-info mt-3">
            <b>Diagnosis:</b> @diagnosis
        </div>
    }

</div>

@code {
    // Modell für die Eingabewerte
    public class CBCInput
    {
        public float RBC { get; set; }
        public float HGB { get; set; }
        public float WBC { get; set; }
        public float Platelets { get; set; }

        // → Hier ALLE Features deiner CSV ergänzen!
        // public float MCV { get; set; }
        // public float XYZ { get; set; }
    }

    private CBCInput cbc = new();
    private string? diagnosis = null;

    private async Task SendPrediction()
    {
        try
        {
            var response = await Http.PostAsJsonAsync("https://localhost:8000/predict", cbc);

            if (!response.IsSuccessStatusCode)
            {
                diagnosis = "Error calling API: " + response.ReasonPhrase;
                return;
            }

            var result = await response.Content.ReadFromJsonAsync<PredictionResult>();
            diagnosis = result?.diagnosis ?? "No result";
        }
        catch (Exception ex)
        {
            diagnosis = "Exception: " + ex.Message;
        }
    }

    public class PredictionResult
    {
        public string diagnosis { get; set; }
    }
}
